<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

<!-- Mirrored from blog.atom.io/2014/09/16/new-event-subscription-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 23 Sep 2022 14:36:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../../css/application.css">
  <link rel="shortcut icon" href="../../../favicon.ico"/>
  <link type="application/atom+xml" rel="alternate" href="../../../feed.xml" title="Atom Blog" />
  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>A New Event Subscription API | Atom Blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="A New Event Subscription API" />
<meta name="author" content="nathansobo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A hackable text editor for the 21st Century" />
<meta property="og:description" content="A hackable text editor for the 21st Century" />
<link rel="canonical" href="new-event-subscription-api.html" />
<meta property="og:url" content="new-event-subscription-api.html" />
<meta property="og:site_name" content="Atom Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-09-16T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@AtomEditor" />
<meta name="twitter:creator" content="@nathansobo" />
<meta property="article:publisher" content="https://www.facebook.com/GitHub" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.atom.io/2014/09/16/new-event-subscription-api.html"},"url":"https://blog.atom.io/2014/09/16/new-event-subscription-api.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.atom.io/img/blog-logo.png"},"name":"nathansobo"},"headline":"A New Event Subscription API","dateModified":"2014-09-16T00:00:00+00:00","datePublished":"2014-09-16T00:00:00+00:00","author":{"@type":"Person","name":"nathansobo"},"description":"A hackable text editor for the 21st Century","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-3769691-48', 'auto');
    ga('send', 'pageview');
  </script>
</head>
<body>

  <div class="footer-push">

    <div class="top-bar">
  <div class="wrapper">
    <ul class="navigation">
      <li><h1 title="Atom: A hackable text editor for the 21st Century"><a href="https://atom.io/" class="logo-small"></a></h1></li>
      <li><a href="https://atom.io/packages">Packages</a></li>
      <li><a href="https://atom.io/themes">Themes</a></li>
      <li><a href="https://atom.io/docs">Documentation</a></li>
      <li><a href="../../../index.html" class="is-selected">Blog</a></li>
      <li><a href="https://discuss.atom.io/">Discuss</a></li>
    </ul>

    <div class="top-bar-right">
      <a href="../../../feed.xml" class="rss-link"><span class="octicon octicon-rss"></span> Subscribe</a>
    </div>
  </div>
</div>


    <div class="wrapper content-push">
<div class="post">
  <h2 class="post-name">A New Event Subscription API</h2>

  <p class="who-when">
    <span class="octicon octicon-calendar"></span> September 16, 2014 <a href="https://github.com/nathansobo" class="author-link"><img class="avatar avatar-small" alt="nathansobo" width="18" height="18" data-proofer-ignore="true" src="https://avatars1.githubusercontent.com/nathansobo?v=3&amp;s=18" srcset="https://avatars1.githubusercontent.com/nathansobo?v=3&s=18 1x, https://avatars1.githubusercontent.com/nathansobo?v=3&s=36 2x, https://avatars1.githubusercontent.com/nathansobo?v=3&s=54 3x, https://avatars1.githubusercontent.com/nathansobo?v=3&s=72 4x" /> nathansobo</a>
    <a href="https://twitter.com/share" class="twitter-share-button" data-via="AtomEditor">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </p>
  <div class="post markdown">
    <style>
.editor-colors {
  font-family: monospace;
}
</style>

<p>We’ve recently been focusing on cleaning up Atom’s API, improving its consistency and usability before we commit to supporting it without breaking changes after Atom reaches version 1.0. As part of this effort, we’re changing our approach to event subscription in Atom.</p>

<p>The previous design grew organically at a time when jQuery played a prominent role in Atom. As a result, we designed our event API to blend in with jQuery’s <code class="highlighter-rouge">.on</code> and <code class="highlighter-rouge">.off</code> methods, which are based on passing around event names as strings. Over time, we’ve found this approach to be less than ideal in a number of respects.</p>

<h2 id="the-old-approach">The Old Approach</h2>

<p>String-based events are awkward to document and difficult to inspect at runtime. When subscribing, it’s possible to pass an event name that isn’t even emitted by the target object without receiving an error or warning. Unsubscribing is also confusing due to features we borrowed from jQuery that ended up being anti-patterns, such as namespaces and the ability to cancel subscriptions registered by other packages via <code class="highlighter-rouge">.off()</code>.</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Subscribing</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span class="variable assignment coffee"><span class="variable assignment coffee"><span>subscription&nbsp;</span><span class="keyword operator coffee"><span>=</span></span></span></span><span>&nbsp;editor</span><span class="meta delimiter method period coffee"><span>.</span></span><span>on&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>changed.my-namespace</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span class="meta delimiter object comma coffee"><span>,&nbsp;</span></span><span class="meta function coffee"><span class="entity name function coffee"><span>handler&nbsp;</span></span></span><span class="keyword operator coffee"><span>=</span></span><span>&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(change)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Unsubscribing</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>subscription</span><span class="meta delimiter method period coffee"><span>.</span></span><span>off</span><span class="meta brace round coffee"><span>(</span><span>)</span></span></span></div><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;or...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>editor</span><span class="meta delimiter method period coffee"><span>.</span></span><span>off&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>changed</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span class="meta delimiter object comma coffee"><span>,&nbsp;</span></span><span>handler</span></span></div><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;or...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>editor</span><span class="meta delimiter method period coffee"><span>.</span></span><span>off&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>changed.my-namespace</span><span class="punctuation definition string end coffee"><span>'</span></span></span></span></div><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;or...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>editor</span><span class="meta delimiter method period coffee"><span>.</span></span><span>off&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>changed</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;ruin&nbsp;everything&nbsp;by&nbsp;unsubscribing&nbsp;everyone</span><span>&nbsp;</span></span></span></div></pre>

<h2 id="the-new-approach">The New Approach</h2>

<p>In our new approach to event subscription, we decided to focus on simplicity and consistency above all else. There should be <em>one</em> way to subscribe and <em>one</em> way to unsubscribe, and mixins shouldn’t be required to interact with or implement event-based APIs. To support these goals, we’ve introduced explicit methods for subscribing to events:</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Subscribing</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span class="variable assignment coffee"><span class="variable assignment coffee"><span>subscription&nbsp;</span><span class="keyword operator coffee"><span>=</span></span></span></span><span>&nbsp;editor</span><span class="meta delimiter method period coffee"><span>.</span></span><span>onDidChange&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(change)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Unsubscribing</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>subscription</span><span class="meta delimiter method period coffee"><span>.</span></span><span>dispose</span><span class="meta brace round coffee"><span>(</span><span>)</span></span></span></div></pre>

<p>Event names always start with <code class="highlighter-rouge">onDid</code> or <code class="highlighter-rouge">onWill</code>, then follow with a verb and an optional noun. For example, <code class="highlighter-rouge">::onWillSave</code> or <code class="highlighter-rouge">::onDidChangePath</code>. While the auxilliary “will” or “did” adds a bit to the length, it makes it easy to name all the methods according to a consistent scheme, regardless of when callbacks are invoked relative to the named event.</p>

<h2 id="managing-subscriptions">Managing Subscriptions</h2>

<p>As you saw above, whenever you subscribe to an event via a new subscription method, it returns a <em>disposable</em> instance. If the lifetime of the <em>observing</em> object is shorter than that of the <em>observed</em> object, it’s important that you cancel the subscription by calling <code class="highlighter-rouge">.dispose()</code> on this disposable when the subscription is no longer needed. Failure to do this will cause a memory leak.</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="meta class coffee"><span class="storage type class coffee"><span>class</span></span><span>&nbsp;</span><span class="entity name type class coffee"><span>Observer</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>constructor</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(observed)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscription</span></span><span>&nbsp;</span><span class="keyword operator coffee"><span>=</span></span><span>&nbsp;observed</span><span class="meta delimiter method period coffee"><span>.</span></span><span>onDidChange&nbsp;</span><span class="storage type function coffee"><span>=&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>destroy</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscription</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>dispose</span><span class="meta brace round coffee"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Don't&nbsp;forget&nbsp;to&nbsp;cancel&nbsp;your&nbsp;subscription!</span><span>&nbsp;</span></span></span></div></pre>

<p>If you’re making multiple subscriptions, our new helper library <a href="https://github.com/atom/event-kit">event-kit</a> has a simple <code class="highlighter-rouge">CompositeDisposable</code> class that you can use to aggregate multiple disposables.</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;include&nbsp;event-kit&nbsp;as&nbsp;a&nbsp;dependency&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;this</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span class="meta variable assignment destructured object coffee"><span class="keyword operator coffee"><span>{</span></span><span class="variable assignment coffee"><span class="variable assignment coffee"><span>CompositeDisposable</span></span></span><span class="keyword operator coffee"><span>}&nbsp;=</span></span></span><span>&nbsp;</span><span class="support function coffee"><span>require</span></span><span>&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>event-kit</span><span class="punctuation definition string end coffee"><span>'</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span class="meta class coffee"><span class="storage type class coffee"><span>class</span></span><span>&nbsp;</span><span class="entity name type class coffee"><span>Observer</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>constructor</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(observed1,&nbsp;observed2)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscriptions</span></span><span>&nbsp;</span><span class="keyword operator coffee"><span>=</span></span><span>&nbsp;</span><span class="meta class instance constructor"><span class="keyword operator new coffee"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance coffee"><span>CompositeDisposable</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscriptions</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>add&nbsp;observed1</span><span class="meta delimiter method period coffee"><span>.</span></span><span>onDidChange&nbsp;</span><span class="storage type function coffee"><span>=&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscriptions</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>add&nbsp;observed1</span><span class="meta delimiter method period coffee"><span>.</span></span><span>onDidActivate&nbsp;</span><span class="storage type function coffee"><span>=&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscriptions</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>add&nbsp;observed2</span><span class="meta delimiter method period coffee"><span>.</span></span><span>onWillDance&nbsp;</span><span class="storage type function coffee"><span>=&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>destroy</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@subscriptions</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>dispose</span><span class="meta brace round coffee"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;Dispose&nbsp;of&nbsp;all&nbsp;subscriptions&nbsp;at&nbsp;once</span><span>&nbsp;</span></span></span></div></pre>

<p>Managing subscriptions was previously handled by including the <code class="highlighter-rouge">Subscriber</code> mixin from the <a href="https://github.com/atom/emissary">emissary</a> library, which gave the including object <code class="highlighter-rouge">subscribe</code> and <code class="highlighter-rouge">unsubscribe</code> methods. We’ve now opted to use an explicit disposable instance instead, because it’s not always possible or desirable to introduce a mixin in a situation where subscription tracking is needed. By making subscription management explicit, we hope to also make it easier to understand and emulate.</p>

<p>We plan to completely replace emissary with event-kit. Emissary is encumbered by supporting too many features we no longer need and is actually hurting performance because of it. By switching to a new, radically simplified library, we can easily leave the old event support in place during the deprecation period.</p>

<h2 id="implementing-event-oriented-apis">Implementing Event-Oriented APIs</h2>

<p><a href="https://github.com/atom/event-kit">Event-kit</a> also provides a simple toolkit for implementing event-oriented APIs. Using the library is completely optional, but it’s a convenient way to build out APIs that blend in with the rest of Atom. Here’s the pattern we now use internally to implement events:</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="meta variable assignment destructured object coffee"><span class="keyword operator coffee"><span>{</span></span><span class="variable assignment coffee"><span class="variable assignment coffee"><span>Emitter</span></span></span><span class="keyword operator coffee"><span>}&nbsp;=</span></span></span><span>&nbsp;</span><span class="support function coffee"><span>require</span></span><span>&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>event-kit</span><span class="punctuation definition string end coffee"><span>'</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span class="meta class coffee"><span class="storage type class coffee"><span>class</span></span><span>&nbsp;</span><span class="entity name type class coffee"><span>Observed</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>constructor</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span>&nbsp;</span><span class="keyword operator coffee"><span>=</span></span><span>&nbsp;</span><span class="meta class instance constructor"><span class="keyword operator new coffee"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance coffee"><span>Emitter</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>onDidChange</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(callback)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>on&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>did-change</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span class="meta delimiter object comma coffee"><span>,&nbsp;</span></span><span>callback</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>change</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;do&nbsp;changes...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>emit&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>did-change</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span class="meta delimiter object comma coffee"><span>,&nbsp;</span></span><span>changeEvent&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;1&nbsp;optional&nbsp;argument&nbsp;allowed</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>destroy</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>dispose</span><span class="meta brace round coffee"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;remove&nbsp;subscribers&nbsp;on&nbsp;destruction</span><span>&nbsp;</span></span></span></div></pre>

<p>The emitter automatically returns a <code class="highlighter-rouge">Disposable</code> instance which can be used to unsubscribe. You can also create your own disposable instance with an action to perform on disposal, which can be useful if you want to track when observers unsubscribe.</p>

<pre class="editor-colors lang-coffee"><div class="line"><span class="source coffee"><span class="meta variable assignment destructured object coffee"><span class="keyword operator coffee"><span>{</span></span><span class="variable assignment coffee"><span class="variable assignment coffee"><span>Emitter</span></span></span><span>,&nbsp;</span><span class="variable assignment coffee"><span class="variable assignment coffee"><span>Disposable</span></span></span><span class="keyword operator coffee"><span>}&nbsp;=</span></span></span><span>&nbsp;</span><span class="support function coffee"><span>require</span></span><span>&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>event-kit</span><span class="punctuation definition string end coffee"><span>'</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span class="meta class coffee"><span class="storage type class coffee"><span>class</span></span><span>&nbsp;</span><span class="entity name type class coffee"><span>Observed</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>constructor</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span>&nbsp;</span><span class="keyword operator coffee"><span>=</span></span><span>&nbsp;</span><span class="meta class instance constructor"><span class="keyword operator new coffee"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance coffee"><span>Emitter</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>onDidChange</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="meta inline function coffee"><span class="variable parameter function coffee"><span>(callback)</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable assignment coffee"><span class="variable assignment coffee"><span>subscription&nbsp;</span><span class="keyword operator coffee"><span>=</span></span></span></span><span>&nbsp;</span><span class="variable other readwrite instance coffee"><span>@emitter</span></span><span class="meta delimiter method period coffee"><span>.</span></span><span>on&nbsp;</span><span class="string quoted single coffee"><span class="punctuation definition string begin coffee"><span>'</span></span><span>did-change</span><span class="punctuation definition string end coffee"><span>'</span></span></span><span class="meta delimiter object comma coffee"><span>,&nbsp;</span></span><span>callback</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@changeSubscriptionAdded</span></span><span class="meta brace round coffee"><span>(</span><span>)</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta class instance constructor"><span class="keyword operator new coffee"><span>new</span></span><span>&nbsp;</span><span class="entity name type instance coffee"><span>Disposable</span></span></span><span>&nbsp;</span><span class="storage type function coffee"><span>=&gt;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other readwrite instance coffee"><span>@changeSubscriptionRemoved</span></span><span class="meta brace round coffee"><span>(</span><span>)</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subscription</span><span class="meta delimiter method period coffee"><span>.</span></span><span>dispose</span><span class="meta brace round coffee"><span>(</span><span>)</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>changeSubscriptionAdded</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="meta function coffee"><span class="entity name function coffee"><span>changeSubscriptionRemoved</span></span></span><span class="keyword operator coffee"><span>:</span></span><span>&nbsp;</span><span class="storage type function coffee"><span>-&gt;</span></span><span>&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source coffee"><span>&nbsp;</span></span></div><div class="line"><span class="source coffee"><span>&nbsp;&nbsp;</span><span class="comment line number-sign coffee"><span class="punctuation definition comment coffee"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div></pre>

<h2 id="conclusion">Conclusion</h2>

<p>The old string-based approach to events will continue to work for now, but as of Atom 0.126.0, you’ll see deprecation warnings in the spec runner guiding you to use the new approach. Once we complete some other planned changes to the API, we’ll start showing deprecation warnings to users and make a big push to switch all packages to the 1.0 APIs before removing the deprecated methods entirely. Thanks for rolling with us as we iterate on the package authoring experience.</p>


  </div>
</div>

<div class="feedback">
  <p>Have feedback on this post? Let <a class="twitter-handle" href="https://twitter.com/intent/tweet?text=@AtomEditor%20&amp;related=atomeditor&amp;url=/2014/09/16/new-event-subscription-api.html">@AtomEditor</a> know on Twitter.</p>
  <p>Need help or found a bug? <a href="https://atom.io/contact">Contact us.</a></p>
</div>
</div>

    <div class="footer-pad"></div>
  </div>

  <footer>
  <div class="footer">
    <div class="wrapper">
      <ul class="footer-left">
        <li><a href="https://github.com/site/terms">Terms of Use</a></li>
        <li><a href="https://atom.io/releases">Releases</a></li>
        <li><a href="https://atom.io/faq">FAQ</a></li>
        <li><a href="https://atom.io/contact">Contact</a></li>
      </ul>

      <div class="footer-right">
        <a href="https://github.com/"><span class="octicon octicon-code"></span> with <span class="octicon octicon-heart"></span> by <span class="octicon octicon-logo-github"></span></a>
      </div>
    </div>
  </div>
</footer>

</body>

<!-- Mirrored from blog.atom.io/2014/09/16/new-event-subscription-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 23 Sep 2022 14:36:29 GMT -->
</html>
